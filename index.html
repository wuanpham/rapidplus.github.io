<div style="font-family: sans-serif; max-width: 400px;">
  <h3>ESP32 OTA Update</h3>
  <label>ESP32 IP Address:</label><br>
  <input id="ip" type="text" placeholder="192.168.x.x" style="width:100%;"><br><br>
  <input type="file" id="file"><br><br>
  <button onclick="uploadFirmware()">Upload & Update</button>
  <p id="status"></p>
</div>

<script>
async function uploadFirmware() {
  const ip = document.getElementById('ip').value.trim();
  const fileInput = document.getElementById('file');
  const status = document.getElementById('status');
  if (!ip || fileInput.files.length === 0) {
    status.innerText = "Please enter IP and choose .bin file";
    return;
  }

  const file = fileInput.files[0];
  const url = `http://${ip}/update`;
  status.innerText = "Uploading...";

  try {
    const res = await fetch(url, {
      method: "POST",
      body: file,
      headers: {
        "Content-Type": "application/octet-stream"
      }
    });
    const text = await res.text();
    status.innerText = text.includes("OK") ? "✅ Update success! Rebooting device..." : "❌ Update failed: " + text;
  } catch (e) {
    status.innerText = "❌ Error: " + e;
  }
}
</script>
